<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>เข้าสู่ระบบ</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
      body { display: flex; justify-content: center; align-items: center; height: 100vh; }
      article { width: 100%; max-width: 400px; }
    </style>
</head>
<body>
    <main class="container">
      <article>
        <h2 style="text-align: center;">เข้าสู่ระบบจัดการสต๊อก</h2>
        <form id="loginForm">
          <label for="username">ชื่อผู้ใช้</label>
          <input type="text" id="username" name="username" required>
          <label for="password">รหัสผ่าน</label>
          <input type="password" id="password" name="password" required>
          <button type="submit" id="loginButton">เข้าสู่ระบบ</button>
        </form>
        <p id="error-message" style="color: red; text-align: center; display: none;"></p>
      </article>
    </main>
    <script>
      const API_URL = "https://script.google.com/macros/s/AKfycbymkoZdbZLGtIEdceZTlk_WnsOfTkxHlarzzPR3_gbTNY1tZ5pI0IT_D4WeI5qRFc6JoA/exec"; // <-- PASTE YOUR URL HERE

      document.getElementById('loginForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const loginButton = document.getElementById('loginButton');
        const errorMessage = document.getElementById('error-message');
        loginButton.setAttribute('aria-busy', 'true');
        errorMessage.style.display = 'none';

        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        try {
          const res = await fetch(API_URL, {
            method: 'POST',
            headers: {'Content-Type': 'text/plain;charset=utf-8'},
            body: JSON.stringify({ action: 'checkLogin', username, password })
          });
          const result = await res.json();

          if (result.status === 'success' && result.data.loggedIn) {
            sessionStorage.setItem('stockUser', result.data.user);
            sessionStorage.setItem('stockUserRole', result.data.role);
            const userRole = result.data.role;
            if (userRole === 'Sales' || userRole === 'Accounting') {
                window.location.href = 'onhand.html';
            } else {
                window.location.href = 'main.html';
            }
          } else {
            errorMessage.textContent = 'ชื่อผู้ใช้หรือรหัสผ่านไม่ถูกต้อง';
            errorMessage.style.display = 'block';
            loginButton.removeAttribute('aria-busy');
          }
        } catch (error) {
          errorMessage.textContent = 'เกิดข้อผิดพลาดในการเชื่อมต่อ';
          errorMessage.style.display = 'block';
          loginButton.removeAttribute('aria-busy');
        }
      });
    </script>
</body>
</html>
